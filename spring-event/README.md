# Spring Event

## 场景：执行操作2时补充操作1

### 流程

发起操作2 -> 发现资源未完成操作1 -> 发起操作1，同步等待完成 -> 操作1完成后，发布操作1完成的事件 -> 继续完成操作2 ->
发布操作2完成的事件

#### 实现同步

仅使用`@TransactionalEventListener`无法实现同步消费，必须使用`@EventListener`才能实现

#### 嵌套事件

通过事件发起补充执行操作1，补充完毕后会发布一个操作1执行完成的事件。形成嵌套

`@TransactionalEventListener`的监听器发布的事件无法被监听到, 而`@EventListener`的监听器发布的事件能被监听到

#### 事务性

##### 同步监听器

同步的监听器中抛出异常，发布者将会回滚

##### 异步监听器

`@TransactionalEventListener`异步监听器存在两种情况

* BEFORE_COMMIT：监听器抛出异常后，发布者将会回滚
* AFTER_COMMIT: 监听器抛出异常后，发布者不回滚，甚至没有打印异常堆栈信息。嵌套事件的监听器发货所能异常也会回滚。TODO：检查切点是否能获取到
